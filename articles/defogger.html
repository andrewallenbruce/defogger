<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="defogger">
<title>defogger • defogger</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.2/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.2/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.2/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="defogger">
<meta property="og:description" content="defogger">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">defogger</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/defogger.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="http://twitter.com/aabrucehimni" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/andrewallenbruce/defogger/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>defogger</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/andrewallenbruce/defogger/blob/HEAD/vignettes/defogger.Rmd" class="external-link"><code>vignettes/defogger.Rmd</code></a></small>
      <div class="d-none name"><code>defogger.Rmd</code></div>
    </div>

    
    
<p>This vignette provides an introduction to the basic functionality included in the package.</p>
<p><br><br></p>
<div class="section level2">
<h2 id="problem-statement">Problem Statement<a class="anchor" aria-label="anchor" href="#problem-statement"></a>
</h2>
<p>The Transparency in Coverage files only include the NPI of the provider.</p>
<div class="section level3">
<h3 id="using-the-defog_toc-function">Using the <code>defog_toc()</code> Function<a class="anchor" aria-label="anchor" href="#using-the-defog_toc-function"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/andrewallenbruce/defogger" class="external-link">defogger</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assign TiC file link to object</span></span>
<span><span class="va">centene_url</span> <span class="op">&lt;-</span> <span class="st">"https://www.centene.com/content/dam/centene/Centene%20Corporate/json/DOCUMENT/2022-06-29_ambetter_index.json"</span></span>
<span></span>
<span><span class="co"># Retrieve file with defog_get() function</span></span>
<span><span class="va">centene_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defog_toc.html">defog_toc</a></span><span class="op">(</span><span class="va">centene_url</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#----This returns a tibble of 2,598 rows so, </span></span>
<span><span class="co">#----in the interest of space, we'll look at the first 10</span></span>
<span></span>
<span><span class="co"># View first 10 rows of result</span></span>
<span><span class="va">centene_results</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 8</span></span></span>
<span><span class="co">#&gt;       id plan_name                plan_…¹ plan_id plan_…² entity rate_…³ locat…⁴</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 <span style="color: #949494;">"</span>Minimum Coverage Ambet… HIOS    67138C… indivi… Cente… in_net… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1 <span style="color: #949494;">"</span>Minimum Coverage Ambet… HIOS    67138C… indivi… Cente… out_of… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     1 <span style="color: #949494;">"</span>Minimum Coverage Ambet… HIOS    99110C… indivi… Cente… in_net… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     1 <span style="color: #949494;">"</span>Minimum Coverage Ambet… HIOS    99110C… indivi… Cente… out_of… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     1 <span style="color: #949494;">"</span>Silver 70 Ambetter EPO… HIOS    99110C… indivi… Cente… in_net… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     1 <span style="color: #949494;">"</span>Silver 70 Ambetter EPO… HIOS    99110C… indivi… Cente… out_of… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     1 <span style="color: #949494;">"</span>Silver 70 Ambetter PPO… HIOS    99110C… indivi… Cente… in_net… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     1 <span style="color: #949494;">"</span>Silver 70 Ambetter PPO… HIOS    99110C… indivi… Cente… out_of… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     1 <span style="color: #949494;">"</span>Bronze 60 Ambetter HSP… HIOS    67138C… indivi… Cente… in_net… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     1 <span style="color: #949494;">"</span>Bronze 60 Ambetter HSP… HIOS    67138C… indivi… Cente… out_of… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable names ¹​plan_id_type, ²​plan_market_type,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ³​rate_type, ⁴​location</span></span></span></code></pre></div>
<p><br></p>
<p><code><a href="../reference/defog_toc_centene.html">defog_toc_centene()</a></code> is the first of many helper functions, included here to differentiate between Centene as the reporting entity (third party administrator) and it’s two sub-entities, Ambetter and Magellan:</p>
<p><br></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add reporting entity and sub-entity</span></span>
<span><span class="va">centene_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defog_toc_centene.html">defog_toc_centene</a></span><span class="op">(</span><span class="va">centene_results</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View results</span></span>
<span><span class="va">centene_results</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 10</span></span></span>
<span><span class="co">#&gt;       id state entity    sub_e…¹ plan_…² plan_…³ plan_id plan_…⁴ rate_…⁵ locat…⁶</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 CA    Centene … Ambett… <span style="color: #949494;">"</span>Minim… HIOS    67138C… indivi… in_net… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1 CA    Centene … Ambett… <span style="color: #949494;">"</span>Minim… HIOS    67138C… indivi… out_of… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     1 CA    Centene … Ambett… <span style="color: #949494;">"</span>Minim… HIOS    99110C… indivi… in_net… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     1 CA    Centene … Ambett… <span style="color: #949494;">"</span>Minim… HIOS    99110C… indivi… out_of… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     1 CA    Centene … Ambett… <span style="color: #949494;">"</span>Silve… HIOS    99110C… indivi… in_net… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     1 CA    Centene … Ambett… <span style="color: #949494;">"</span>Silve… HIOS    99110C… indivi… out_of… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     1 CA    Centene … Ambett… <span style="color: #949494;">"</span>Silve… HIOS    99110C… indivi… in_net… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     1 CA    Centene … Ambett… <span style="color: #949494;">"</span>Silve… HIOS    99110C… indivi… out_of… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     1 CA    Centene … Ambett… <span style="color: #949494;">"</span>Bronz… HIOS    67138C… indivi… in_net… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     1 CA    Centene … Ambett… <span style="color: #949494;">"</span>Bronz… HIOS    67138C… indivi… out_of… http:/…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable names ¹​sub_entity, ²​plan_name, ³​plan_id_type,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁴​plan_market_type, ⁵​rate_type, ⁶​location</span></span></span></code></pre></div>
<p><br></p>
<p>Next, we need to download the Out-of-Network (OON) and In-Network (INN) files.</p>
</div>
<div class="section level3">
<h3 id="using-the-defog_oon-function">Using the <code>defog_oon()</code> Function<a class="anchor" aria-label="anchor" href="#using-the-defog_oon-function"></a>
</h3>
<p>From the results above, we can filter to the <code>out_of_network</code> files and choose a state. California’s the only state in the first 10 rows so we’ll go with CA:</p>
<p><br></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter to OON California URL</span></span>
<span><span class="va">centene_oon_CA_url</span> <span class="op">&lt;-</span> <span class="va">centene_results</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rate_type</span> <span class="op">==</span> <span class="st">"out_of_network"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">state</span> <span class="op">==</span> <span class="st">"CA"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html" class="external-link">deframe</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View URL</span></span>
<span><span class="va">centene_oon_CA_url</span></span>
<span><span class="co">#&gt; [1] "http://centene.com/content/dam/centene/Centene%20Corporate/json/DOCUMENT/2022-06-29_centene-management-company-llc_ambetter-ca_allowed-amounts.json"</span></span></code></pre></div>
<p><br></p>
<p>Next, plug the URL object into the <code><a href="../reference/defog_oon.html">defog_oon()</a></code> function and retrieve the file:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve the file</span></span>
<span><span class="va">centene_oon_CA_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/defog_oon.html">defog_oon</a></span><span class="op">(</span><span class="va">centene_oon_CA_url</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View results</span></span>
<span><span class="va">centene_oon_CA_results</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 11</span></span></span>
<span><span class="co">#&gt;    name    billi…¹ billi…² billi…³ descr…⁴ ein   servi…⁵ billi…⁶ allow…⁷ bille…⁸</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ANES U… CPT     2022    00813   ANESTH… 3301… 24      profes…  <span style="text-decoration: underline;">1</span>568     <span style="text-decoration: underline;">4</span>655 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> NFCT D… HCPCS   2022    0202U   NFCT D… 8220… 20      profes…  <span style="text-decoration: underline;">9</span>586.   <span style="text-decoration: underline;">33</span>925 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ANTIBO… HCPCS   2022    0224U   ANTB S… 4641… 11      profes…  <span style="text-decoration: underline;">1</span>475.   <span style="text-decoration: underline;">10</span>500 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> NFCT D… HCPCS   2022    0225U   NFCT D… 4552… 20      profes…  <span style="text-decoration: underline;">8</span>231.   <span style="text-decoration: underline;">47</span>500 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> PHARMA… RC      2022    250     PHARMA… 9516… 22      instit…   834.     483.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> PHARMA… RC      2022    250     PHARMA… 9516… 22      instit…  <span style="text-decoration: underline;">1</span>159.     219.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> PHARMA… RC      2022    250     PHARMA… 9516… 22      instit…    25.6     32 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> PHARMA… RC      2022    250     PHARMA… 9516… 23      instit…   834.     483.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> PHARMA… RC      2022    250     PHARMA… 9516… 23      instit…  <span style="text-decoration: underline;">1</span>159.     219.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> PHARMA… RC      2022    250     PHARMA… 9516… 23      instit…    25.6     32 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 1 more variable: npi &lt;chr&gt;, and abbreviated variable names</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ¹​billing_code_type, ²​billing_code_type_version, ³​billing_code,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁴​description, ⁵​service_code, ⁶​billing_class, ⁷​allowed_amount,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   ⁸​billed_charge</span></span></span></code></pre></div>
<p><br></p>
<p>This returns all of the information required by the Transparency in Coverage rule. However, simply having a provider’s NPI isn’t very helpful for analysis. Where do they practice? What specialty are they? Are they part of an organization or just an individual? This is where the NPPES NPI Registry Search comes in.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="using-the-defog_npi-function">Using the <code>defog_npi()</code> Function<a class="anchor" aria-label="anchor" href="#using-the-defog_npi-function"></a>
</h3>
<p>First, we need to isolate the distinct NPIs from the <code>out_of_network</code> results above and unlist them. There are 247 so we’ll take the first 10 to keep this example as lightweight as we can:</p>
<p><br></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter to distinct NPIs and unlist</span></span>
<span><span class="va">centene_oon_CA_npi</span> <span class="op">&lt;-</span> <span class="va">centene_oon_CA_results</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">npi</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span>use.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View results</span></span>
<span><span class="va">centene_oon_CA_npi</span></span>
<span><span class="co">#&gt; [1] "1104868124" "1366964330" "1760041487" "1902967557" "1710065933"</span></span></code></pre></div>
<p><br></p>
<p>Then pipe them into the NPPES search function, <code><a href="../reference/defog_npi.html">defog_npi()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">centene_oon_CA_npi2</span> <span class="op">&lt;-</span> <span class="va">centene_oon_CA_npi</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="va">defog_npi</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View results</span></span>
<span><span class="va">centene_oon_CA_npi2</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 4</span></span></span>
<span><span class="co">#&gt;   search     datetime            outcome data_lists   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1104868124 2022-08-25 <span style="color: #949494;">18:39:58</span> results <span style="color: #949494;">&lt;df [1 × 11]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1366964330 2022-08-25 <span style="color: #949494;">18:40:00</span> results <span style="color: #949494;">&lt;df [1 × 11]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1760041487 2022-08-25 <span style="color: #949494;">18:40:02</span> results <span style="color: #949494;">&lt;df [1 × 11]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1902967557 2022-08-25 <span style="color: #949494;">18:40:05</span> results <span style="color: #949494;">&lt;df [1 × 11]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1710065933 2022-08-25 <span style="color: #949494;">18:40:07</span> results <span style="color: #949494;">&lt;df [1 × 11]&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Start with base df and unnest first level</span></span>
<span><span class="va">start</span> <span class="op">&lt;-</span> <span class="va">centene_oon_CA_npi2</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"results"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">data_lists</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Isolate the NPI and datetime</span></span>
<span><span class="va">search</span> <span class="op">&lt;-</span> <span class="va">start</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">search</span><span class="op">:</span><span class="va">datetime</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">search</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">datetime</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## || CREATE ID KEY</span></span>
<span><span class="va">key</span> <span class="op">&lt;-</span> <span class="va">search</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span>use.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Rename number &amp; enumeration type</span></span>
<span><span class="va">basic_1</span> <span class="op">&lt;-</span> <span class="va">start</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    prov_type <span class="op">=</span> <span class="va">enumeration_type</span>,</span>
<span>    npi <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    npi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">npi</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="va">key</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Basic section</span></span>
<span><span class="va">basic_2</span> <span class="op">&lt;-</span> <span class="va">start</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">basic</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">basic</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">key</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Join Columns</span></span>
<span><span class="va">basic</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">basic_1</span>, <span class="va">basic_2</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Isolate lists</span></span>
<span><span class="va">lists</span> <span class="op">&lt;-</span> <span class="va">start</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">basic</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">&amp;&amp;</span> </span>
<span>  <span class="op">(</span><span class="fu">insight</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/insight/reference/is_empty_object.html" class="external-link">is_empty_object</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">key</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Replace Empty Lists with NA</span></span>
<span><span class="va">lists</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">lists</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">length</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># List names for identification</span></span>
<span><span class="va">ls_names</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/enframe.html" class="external-link">enframe</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lists</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--------------- BEGIN LISTS</span></span>
<span></span>
<span><span class="co"># Addresses section</span></span>
<span><span class="va">addresses</span> <span class="op">&lt;-</span> <span class="va">lists</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">addresses</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">addresses</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Join Columns</span></span>
<span><span class="co">#basic_add &lt;- dplyr::full_join(basic, addresses, by = "id")</span></span>
<span></span>
<span><span class="co"># Taxonomies</span></span>
<span><span class="va">taxonomies</span> <span class="op">&lt;-</span> <span class="va">lists</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">taxonomies</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">taxonomies</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">datawizard</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/datawizard/reference/data_rename.html" class="external-link">data_addprefix</a></span><span class="op">(</span><span class="st">"tax_"</span>, exclude <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Join Columns</span></span>
<span><span class="co">#basic_add_tax &lt;- dplyr::full_join(basic_add, taxonomies, by = "id")</span></span>
<span></span>
<span><span class="co"># Identifiers</span></span>
<span><span class="va">identifiers</span> <span class="op">&lt;-</span> <span class="va">lists</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">identifiers</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">identifiers</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">datawizard</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/datawizard/reference/data_rename.html" class="external-link">data_addprefix</a></span><span class="op">(</span><span class="st">"id_"</span>, exclude <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Join Columns</span></span>
<span><span class="co">#basic_add_tax_id &lt;- dplyr::full_join(basic_add_tax, identifiers, by = "id")</span></span>
<span></span>
<span><span class="co"># Practice Locations</span></span>
<span><span class="va">practiceLocations</span> <span class="op">&lt;-</span> <span class="va">lists</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">practiceLocations</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">practiceLocations</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">datawizard</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/datawizard/reference/data_rename.html" class="external-link">data_addprefix</a></span><span class="op">(</span><span class="st">"pracloc_"</span>, exclude <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Other Names</span></span>
<span><span class="va">other_names</span> <span class="op">&lt;-</span> <span class="va">lists</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">other_names</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">other_names</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">datawizard</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/datawizard/reference/data_rename.html" class="external-link">data_addprefix</a></span><span class="op">(</span><span class="st">"other_"</span>, exclude <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p>Next, we can clean up the results with the <code>prov_nppes_npi_clean()</code> function:</p>
<p><br></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">centene_oon_CA_npi3</span> <span class="op">&lt;-</span> <span class="va">centene_oon_CA_npi2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html" class="external-link">group_split</a></span><span class="op">(</span><span class="va">search</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="va">prov_nppes_npi_clean</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in as_mapper(.f, ...): object 'prov_nppes_npi_clean' not found</span></span>
<span></span>
<span><span class="va">centene_oon_CA_npi3</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): object 'centene_oon_CA_npi3' not found</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View results</span></span>
<span><span class="co"># centene_oon_CA_npi3</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pivot-columns-wide-with-prov_nppes_npi_clean2">Pivot Columns Wide with <code>prov_nppes_npi_clean2()</code><a class="anchor" aria-label="anchor" href="#pivot-columns-wide-with-prov_nppes_npi_clean2"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># centene_oon_CA_npi_wide &lt;- prov_nppes_npi_clean2(centene_oon_CA_npi3)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># centene_oon_CA_npi_wide</span></span></code></pre></div>
<p>Then join the two frames for the final output:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># centene_oon_CA_join &lt;- dplyr::full_join(</span></span>
<span><span class="co">#   centene_oon_CA_results, </span></span>
<span><span class="co">#   centene_oon_CA_npi_wide)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># centene_oon_CA_join</span></span></code></pre></div>
<p><br><br></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Andrew Bruce.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
